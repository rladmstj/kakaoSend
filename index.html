<!-- <!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Kakao Friends Message</title>
  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
</head>
<body>
  <h1>ì¹´í†¡ ì¹œêµ¬ì—ê²Œ "ì•ˆë…•" ë³´ë‚´ê¸°</h1>
  <button id="login">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</button>
  <button id="friends">ì¹œêµ¬ëª©ë¡</button>
  <button id="send">"ì•ˆë…•" ë³´ë‚´ê¸°</button>
  <pre id="log"></pre>

  <script>
    // Kakao.init('ğŸ‘‰ì—¬ê¸°ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ í‚¤');
     Kakao.init('fd68caed7a478deaea50b7a827bf5c3c');
    // fd68caed7a478deaea50b7a827bf5c3c
    console.log(Kakao.isInitialized());

    const log = m => document.getElementById('log').textContent += m + "\n";
    let selectedUuid = null;

    document.getElementById('login').onclick = () => {
      Kakao.Auth.login({
        scope: 'friends talk_message',
        success: res => log('ë¡œê·¸ì¸ OK ' + JSON.stringify(res)),
        fail: err => log('ë¡œê·¸ì¸ ì‹¤íŒ¨ ' + JSON.stringify(err))
      });
    };

    document.getElementById('friends').onclick = () => {
      Kakao.API.request({ url: '/v1/api/talk/friends' })
        .then(r => {
          log('ì¹œêµ¬ëª©ë¡ ' + JSON.stringify(r));
          selectedUuid = r.elements?.[0]?.uuid || null;
        })
        .catch(e => log('ì‹¤íŒ¨ ' + JSON.stringify(e)));
    };

    document.getElementById('send').onclick = () => {
      if (!selectedUuid) return alert("ì¹œêµ¬ ë¨¼ì € ì„ íƒ");
      Kakao.API.request({
        url: '/v1/api/talk/friends/message/default/send',
        data: {
          receiver_uuids: [selectedUuid],
          template_object: {
            object_type: 'text',
            text: 'ì•ˆë…•',
            link: { web_url: location.href }
          }
        }
      })
      .then(r => log('ì „ì†¡ OK ' + JSON.stringify(r)))
      .catch(e => log('ì „ì†¡ ì‹¤íŒ¨ ' + JSON.stringify(e)));
    };
  </script>
</body>
</html>
 -->
 <!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Kakao Friends Message</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
  <style>
    :root { --bg:#0b0c10; --card:#121419; --ink:#e8e8ea; --muted:#9aa0a6; --brand:#fdd835; }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 24px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, "Noto Sans KR", sans-serif;
      background: var(--bg); color: var(--ink);
    }
    h1 { font-size: 20px; margin: 0 0 16px; }
    .wrap { display: grid; gap: 16px; max-width: 900px; margin: 0 auto; }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr; }
    @media (min-width: 860px) { .row { grid-template-columns: 1.2fr 1fr; } }

    .card {
      background: linear-gradient(180deg, #141823, #0f1320 60%);
      border: 1px solid #23283a; border-radius: 14px; padding: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    .title { font-weight: 700; font-size: 14px; letter-spacing: .2px; margin-bottom: 10px; color: #f1f3f5; }
    .muted { color: var(--muted); font-size: 12px; }

    button, input, select, textarea {
      font: inherit; color: var(--ink); background: #1a1f2e; border: 1px solid #2c334a; border-radius: 10px;
    }
    button {
      padding: 10px 14px; cursor: pointer; font-weight: 700;
      background: linear-gradient(180deg, #1f2740, #171d31); border: 1px solid #2b3552;
    }
    button.primary {
      background: linear-gradient(180deg, #ffd54f, #fbc02d);
      color: #1b1b1b; border: none;
    }
    button:disabled { opacity: .6; cursor: not-allowed; }
    input, textarea, select { width: 100%; padding: 10px 12px; }
    .row-cols { display: grid; gap: 10px; grid-template-columns: repeat(3, minmax(0,1fr)); }
    .friend {
      display: grid; gap: 8px; align-content: start; padding: 12px; border-radius: 12px; border: 1px solid #26314a; background:#121827; cursor: pointer;
      transition: transform .05s ease, border-color .15s ease;
    }
    .friend:hover { transform: translateY(-1px); border-color: #3a4d75; }
    .friend.selected { outline: 2px solid #6ea8fe; border-color: #6ea8fe; }
    .friend .nick { font-weight: 700; }
    .btns { display: flex; gap: 8px; flex-wrap: wrap; }
    .log { white-space: pre-wrap; background:#0c1020; border-radius: 10px; padding: 10px; border:1px solid #1f2a48; max-height: 220px; overflow:auto; }
    .row-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .inline { display: inline-flex; gap: 8px; align-items: center; }
    .small { font-size: 12px; }
    .pill { padding: 4px 8px; background:#101728; border:1px solid #2c3550; border-radius:999px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ì¹´í†¡ ì¹œêµ¬ì—ê²Œ ë©”ì‹œì§€ ë³´ë‚´ê¸°</h1>

    <div class="row">
      <!-- ì¢Œì¸¡: ë¡œê·¸ì¸ / ì¹œêµ¬ëª©ë¡ -->
      <div class="card">
        <div class="title">â‘  ë¡œê·¸ì¸ & ì¹œêµ¬ ê°€ì ¸ì˜¤ê¸°</div>
        <div class="btns">
          <button id="loginBtn">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</button>
          <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
          <span id="loginState" class="pill muted">ë¡œê·¸ì¸ ì•ˆ ë¨</span>
        </div>
        <div style="height:10px"></div>
        <div class="btns">
          <button id="fetchFriendsBtn">ì¹œêµ¬ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <span class="muted small">(* <b>friends, talk_message</b> ê¶Œí•œ í•„ìš”, í…ŒìŠ¤í„°ë§Œ ì¡°íšŒ ê°€ëŠ¥)</span>
        </div>
        <div style="height:12px"></div>
        <div id="friendsEmpty" class="muted small" style="display:none;">í‘œì‹œí•  ì¹œêµ¬ê°€ ì—†ì–´ìš”. (ìƒëŒ€ë°©ì´ ì•±ì— ë¡œê·¸ì¸/ê¶Œí•œ ë™ì˜í–ˆëŠ”ì§€ í™•ì¸)</div>
        <div id="friendsGrid" class="row-cols"></div>
      </div>

      <!-- ìš°ì¸¡: ë©”ì‹œì§€ ì‘ì„± / ì „ì†¡ -->
      <div class="card">
        <div class="title">â‘¡ ë©”ì‹œì§€ ì‘ì„± & ì „ì†¡</div>
        <label class="muted small">ë³´ë‚¼ ëŒ€ìƒ</label>
        <input id="selectedFriendLabel" type="text" placeholder="ì•„ì§ ì„ íƒëœ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤." readonly />

        <div style="height:12px"></div>
        <label class="muted small">ë©”ì‹œì§€ ë‚´ìš©</label>
        <textarea id="messageInput" rows="4" placeholder="ê¸°ë³¸ê°’: ì•ˆë…•">ì•ˆë…•</textarea>

        <div style="height:12px"></div>
        <div class="row-actions">
          <div class="inline">
            <input id="includeLink" type="checkbox" checked />
            <label for="includeLink" class="small">ë§í¬ í¬í•¨</label>
          </div>
          <input id="linkInput" type="url" placeholder="ë§í¬ URL (ë¹„ì›Œë‘ë©´ í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œ)" />
        </div>

        <div style="height:12px"></div>
        <div class="btns">
          <button id="sendBtn" class="primary" disabled>ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>
          <button id="clearBtn">ì…ë ¥ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨: ë¡œê·¸ -->
    <div class="card">
      <div class="title">ë¡œê·¸</div>
      <div id="log" class="log"></div>
    </div>
  </div>

  <script>
    // 1) SDK ì´ˆê¸°í™”
    // Kakao.init('ğŸ‘‰ ì—¬ê¸°ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ í‚¤');
    Kakao.init('fd68caed7a478deaea50b7a827bf5c3c');
    console.log('Kakao SDK initialized:', Kakao.isInitialized());

    // 2) DOM í—¬í¼
    const $ = (id) => document.getElementById(id);
    const log = (m, obj) => {
      const t = new Date().toLocaleTimeString();
      $('log').textContent += `[${t}] ${m}${obj ? ' ' + JSON.stringify(obj) : ''}\n`;
      $('log').scrollTop = $('log').scrollHeight;
    };

    // 3) ìƒíƒœ
    let selectedFriend = null;   // { uuid, profile_nickname, profile_thumbnail_image }
    let friends = [];            // ì „ì²´ ëª©ë¡

    // 4) UI ì—…ë°ì´íŠ¸
    function setLoginStateUI() {
      const auth = Kakao.Auth.getAccessToken();
      $('loginState').textContent = auth ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì¸ ì•ˆ ë¨';
    }

    function renderFriends(list) {
      const grid = $('friendsGrid');
      grid.innerHTML = '';
      if (!list || list.length === 0) {
        $('friendsEmpty').style.display = 'block';
        $('sendBtn').disabled = true;
        setSelectedFriend(null);
        return;
      }
      $('friendsEmpty').style.display = 'none';

      list.forEach((f, idx) => {
        const card = document.createElement('div');
        card.className = 'friend';
        card.dataset.uuid = f.uuid;

        const avatar = document.createElement('div');
        avatar.style.width = '100%';
        avatar.style.aspectRatio = '4/3';
        avatar.style.borderRadius = '10px';
        avatar.style.background = `center/cover no-repeat url(${f.profile_thumbnail_image || ''})`;
        avatar.style.border = '1px solid #2a3552';

        const nick = document.createElement('div');
        nick.className = 'nick';
        nick.textContent = f.profile_nickname || '(ì´ë¦„ ì—†ìŒ)';

        const sub = document.createElement('div');
        sub.className = 'muted small';
        sub.textContent = f.uuid;

        card.appendChild(avatar);
        card.appendChild(nick);
        card.appendChild(sub);

        card.addEventListener('click', () => {
          setSelectedFriend(f);
          // ì„ íƒ ê°•ì¡° ì²˜ë¦¬
          [...grid.children].forEach(el => el.classList.remove('selected'));
          card.classList.add('selected');
        });

        grid.appendChild(card);
      });
    }

    function setSelectedFriend(f) {
      selectedFriend = f;
      if (f) {
        $('selectedFriendLabel').value = `${f.profile_nickname || '(ì´ë¦„ ì—†ìŒ)'} (${f.uuid})`;
        $('sendBtn').disabled = false;
      } else {
        $('selectedFriendLabel').value = '';
        $('sendBtn').disabled = true;
      }
    }

    // 5) ì´ë²¤íŠ¸ ë°”ì¸ë”©
    $('loginBtn').onclick = () => {
      Kakao.Auth.login({
        scope: 'friends talk_message',
        success: (res) => { log('ë¡œê·¸ì¸ ì„±ê³µ', res); setLoginStateUI(); },
        fail: (err) => { log('ë¡œê·¸ì¸ ì‹¤íŒ¨', err); }
      });
    };

    $('logoutBtn').onclick = () => {
      Kakao.Auth.logout(() => {
        log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
        setLoginStateUI();
        renderFriends([]); // ì´ˆê¸°í™”
      });
    };

    $('fetchFriendsBtn').onclick = async () => {
      try {
        const r = await Kakao.API.request({ url: '/v1/api/talk/friends' });
        // r = { elements: [...], total_count, favorite_count, after_url }
        friends = (r && r.elements) ? r.elements : [];
        log('ì¹œêµ¬ëª©ë¡', { total: friends.length });
        renderFriends(friends);
      } catch (e) {
        log('ì¹œêµ¬ëª©ë¡ ì‹¤íŒ¨', e);
      }
    };

    $('clearBtn').onclick = () => {
      $('messageInput').value = 'ì•ˆë…•';
      $('includeLink').checked = true;
      $('linkInput').value = '';
      log('ì…ë ¥ ì´ˆê¸°í™”');
    };

    $('sendBtn').onclick = async () => {
      if (!selectedFriend) return alert('ì¹œêµ¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
      const text = $('messageInput').value?.trim() || 'ì•ˆë…•';
      const includeLink = $('includeLink').checked;
      const linkUrl = $('linkInput').value?.trim() || location.href;

      // Kakao "ê¸°ë³¸ í…ìŠ¤íŠ¸ í…œí”Œë¦¿"ì€ link í•„ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.
      const template_object = {
        object_type: 'text',
        text,
        link: includeLink ? { web_url: linkUrl, mobile_web_url: linkUrl } : { web_url: location.href, mobile_web_url: location.href },
        button_title: 'ì—´ì–´ë³´ê¸°'
      };

      try {
        const r = await Kakao.API.request({
          url: '/v1/api/talk/friends/message/default/send',
          data: {
            receiver_uuids: [selectedFriend.uuid],
            template_object
          }
        });
        log('ì „ì†¡ ì„±ê³µ', r);
      } catch (e) {
        log('ì „ì†¡ ì‹¤íŒ¨', e);
        // ê¶Œí•œ/í…ŒìŠ¤í„°/ë„ë©”ì¸/HTTPS ë¯¸ì ìš© ë“± ë‹¤ì–‘í•œ ì´ìœ ê°€ ìˆì„ ìˆ˜ ìˆìŒ
      }
    };

    // ì´ˆê¸° ìƒíƒœ ë°˜ì˜
    setLoginStateUI();
  </script>
</body>
</html>
